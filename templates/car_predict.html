<!DOCTYPE html>
<html lang="en">
<head xmlns="http://www.w3.org/1999/xhtml">
    <meta charset="UTF-8">
    <title>Car Price Predictor</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" type="text/css"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
            integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
            crossorigin="anonymous"></script>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
          integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.0.0/dist/tf.min.js"></script>
    <style>

        
        /* Make form spacing like Fuel page */
.form-group {
    margin-bottom: 1.2rem;
}

.card-body {
    padding: 2rem;
}

@media (max-width: 768px) {

    .container {
        padding-left: 15px;
        padding-right: 15px;
    }

    .card {
        margin-top: 20px;
    }

    .card-body {
        padding: 20px !important;
    }

    .form-group label {
        font-size: 14px;
    }

    .form-control {
        font-size: 14px;
        padding: 8px;
    }

    .btn-lg {
        font-size: 1rem;
        padding: 10px;
    }

    #prediction {
        font-size: 16px !important;
    }
    .form-control {
        border-radius: 6px;
    }
}
        </style>
</head>
<body style="background: linear-gradient(to right, #141E30, #243B55);">

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow">
        <a class="navbar-brand font-weight-bold" href="/">Automotive System</a>
    
        <!-- Mobile Toggle -->
        <button class="navbar-toggler" type="button"
            data-toggle="collapse"
            data-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
    
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link text-white" href="/">Home</a>
                </li>
    
                {% if current_user.is_authenticated %}
                    <li class="nav-item">
                        <a class="nav-link text-white" href="/predict">Fuel Prediction</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="/logout">Logout</a>
                    </li>
                {% else %}
                    <li class="nav-item">
                        <a class="nav-link text-white" href="/login">Login</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="/signup">Signup</a>
                    </li>
                {% endif %}
            </ul>
        </div>
    </nav>
    
    <div class="container mt-5">
    
        <div class="row justify-content-center">
            <div class="col-12 col-md-10 col-lg-8">
            
    
                <div class="card shadow-lg border-0 rounded-lg">
                    <div class="card-header text-center bg-primary text-white">
                        <h3 class="mb-0">ðŸš— Car Price Predictor</h3>
                    </div>
    
                    <div class="card-body p-4">
    
                        <form method="post" name="Modelform">
    
                            <div class="form-group">
                                <label>Select Company</label>
                                <select class="form-control" id="company" name="company"
                                        onchange="load_car_models(this.id,'car_models')" required>
                                    {% for company in companies %}
                                    <option value="{{ company }}">{{ company }}</option>
                                    {% endfor %}
                                </select>
                            </div>
    
                            <div class="form-group">
                                <label>Select Model</label>
                                <select class="form-control" id="car_models" name="car_models" required></select>
                            </div>
    
                            <div class="form-group">
                                <label>Year of Purchase</label>
                                <select class="form-control" id="year" name="year" required>
                                    {% for year in years %}
                                    <option value="{{ year }}">{{ year }}</option>
                                    {% endfor %}
                                </select>
                            </div>
    
                            <div class="form-group">
                                <label>Fuel Type</label>
                                <select class="form-control" id="fuel_type" name="fuel_type" required>
                                    {% for fuel in fuel_types %}
                                    <option value="{{ fuel }}">{{ fuel }}</option>
                                    {% endfor %}
                                </select>
                            </div>
    
                            <div class="form-group">
                                <label>Kilometers Driven</label>
                                <input type="number" class="form-control"
                                       id="kilo_driven" name="kilo_driven"
                                       placeholder="Enter kms driven" required>
                            </div>
    
                            <div class="text-center mt-4">
                                <button type="button"
                                        class="btn btn-success btn-lg btn-block"
                                        onclick="send_data()">
                                    Predict Price
                                </button>
                            </div>
    
                        </form>
    
                        <div class="text-center mt-4">
                            <div id="prediction"
                                 class="p-3 rounded text-white"
                                 style="background:#343a40; font-size:18px;">
                            </div>
                        </div>
    
                    </div>
                </div>
    
            </div>
        </div>
    
    </div>

<script>

    function load_car_models(company_id,car_model_id)
    {
        var company=document.getElementById(company_id);
        var car_model= document.getElementById(car_model_id);
        console.log(company.value);
        car_model.value="";
        car_model.innerHTML="";
        {% for company in companies %}
            if( company.value == "{{ company }}")
            {
                {% for model in car_models %}
                    {% if company in model %}

                        var newOption= document.createElement("option");
                        newOption.value="{{ model }}";
                        newOption.innerHTML="{{ model }}";
                        car_model.options.add(newOption);
                    {% endif %}
                {% endfor %}
            }
        {% endfor %}
    }

    function form_handler(event) {
        event.preventDefault(); // Don't submit the form normally
    }
    function send_data()
    {
        document.querySelector('form').addEventListener("submit",form_handler);

        var fd=new FormData(document.querySelector('form'));

        var xhr= new XMLHttpRequest({mozSystem: true});

        xhr.open('POST','/car_result',true);
        document.getElementById('prediction').innerHTML="Wait! Predicting Price.....";
        xhr.onreadystatechange = function(){
            if(xhr.readyState == 4 && xhr.status == 200){
                var response = JSON.parse(xhr.responseText);
        
                if(response.car_price_prediction){
                    document.getElementById('prediction').innerHTML =
                        "Prediction: â‚¹ " + response.car_price_prediction;
                } else if(response.error){
                    document.getElementById('prediction').innerHTML =
                        "Error: " + response.error;
                }
            }
        };

        xhr.onload= function(){};

        xhr.send(fd);
    }
</script>


<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
        integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
        crossorigin="anonymous"></script>
</body>
</html>